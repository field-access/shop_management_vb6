' Module1.bas
Public C As ADODB.Connection
Public R As ADODB.Recordset
Public SQL As String

Public Function CONN()
    Set C = New ADODB.Connection
    C.Open "Provider=MSDAORA.1;User ID=sumit/singh;Persist Security Info=False"
    Set R = New ADODB.Recordset
End Function

Public Sub A()
    RES = MsgBox("DO YOU WANT EXIT", vbQuestion + vbYesNoCancel, "FOR EXIT")
    If RES = vbYes Then
        End
    End If
End Sub

' frmLogin.frm
Private Sub Form_Load()
    CONN
End Sub

Private Sub Command1_Click()
    SQL = "SELECT * FROM EMPLOYEE WHERE EMP_ID='" & Text1.Text & "' AND EMP_NAME='" & Text2.Text & "'"
    Set R = C.Execute(SQL)
    If Not R.EOF Then
        MDIForm1.Show
        Unload Me
    Else
        MsgBox "Invalid Login"
        Text1.Text = ""
        Text2.Text = ""
        Text1.SetFocus
    End If
End Sub

Private Sub Command2_Click()
    A
End Sub

' MDIForm1.frm
Private Sub MDIForm_Load()
    Me.WindowState = 2  'Maximized
    Me.Caption = "Electronic Shop Management System"
End Sub

Private Sub mnuProducts_Click()
    frmProduct.Show
End Sub

Private Sub mnuCustomers_Click()
    frmCustomer.Show
End Sub

Private Sub mnuSuppliers_Click()
    frmSupplier.Show
End Sub

Private Sub mnuSales_Click()
    frmSales.Show
End Sub

Private Sub mnuPurchase_Click()
    frmPurchase.Show
End Sub

Private Sub mnuReports_Click()
    frmReports.Show
End Sub

' frmProduct.frm
Private Sub Form_Load()
    CONN
    SQL = "SELECT MAX(PCODE) FROM product"
    Set R = C.Execute(SQL)
    Text1.Text = R.Fields(0) + 1
    Text1.Locked = True
    
    ' Load product types in combo
    Combo1.AddItem "LED Bulb"
    Combo1.AddItem "Fan"
    Combo1.AddItem "Switch"
    Combo1.AddItem "Wire"
    
    AdodcProduct.ConnectionString = C.ConnectionString
    AdodcProduct.RecordSource = "SELECT * FROM product"
    Set DataGrid1.DataSource = AdodcProduct
End Sub

Private Sub Command1_Click()
    AdodcProduct.Recordset.AddNew
    Text1.SetFocus
End Sub

Private Sub Command2_Click()
    AdodcProduct.Recordset.Update
    MsgBox "RECORD SAVED"
End Sub

Private Sub Command3_Click()
    AdodcProduct.Recordset.Delete
    MsgBox "RECORD DELETED"
End Sub

Private Sub Command4_Click()
    A
End Sub

' frmSales.frm
Private Sub Form_Load()
    CONN
    SQL = "SELECT MAX(INV_NO) FROM sale_INVOICE"
    Set R = C.Execute(SQL)
    Text1.Text = R.Fields(0) + 1
    Text1.Locked = True
    Text2.SetFocus
    
    ' Load products
    SQL = "SELECT PNAME FROM product"
    Set R = C.Execute(SQL)
    Do While Not R.EOF
        Combo1.AddItem R!PNAME
        R.MoveNext
    Loop
End Sub

Private Sub Combo1_Click()
    ' Get product price
    SQL = "SELECT MRP, PCODE FROM product WHERE PNAME='" & Combo1.Text & "'"
    Set R = C.Execute(SQL)
    If Not R.EOF Then
        Text4.Text = R!MRP
        Text3.Text = R!PCODE
    End If
End Sub

Private Sub Text5_Change()
    ' Calculate amount when quantity changes
    If Val(Text5.Text) > 0 Then
        Text6.Text = Val(Text4.Text) * Val(Text5.Text)
        Text7.Text = Val(Text6.Text) * 0.18  ' GST
        Text8.Text = Val(Text6.Text) + Val(Text7.Text)
    End If
End Sub

Private Sub Command1_Click()
    ' Add item to grid
    AdodcDetails.Recordset.AddNew
    AdodcDetails.Recordset.Fields("INV_NO") = Text1.Text
    AdodcDetails.Recordset.Fields("PRO_ID") = Text3.Text
    AdodcDetails.Recordset.Fields("PNAME") = Combo1.Text
    AdodcDetails.Recordset.Fields("MRP") = Text4.Text
    AdodcDetails.Recordset.Fields("QTY") = Text5.Text
    AdodcDetails.Recordset.Fields("GST") = Text7.Text
    AdodcDetails.Recordset.Fields("AMOUNT") = Text8.Text
    AdodcDetails.Recordset.Update
    
    ' Update total amount
    CalculateTotalAmount
End Sub

Private Sub Command2_Click()
    ' Save invoice
    AdodcMain.Recordset.AddNew
    AdodcMain.Recordset.Fields("INV_NO") = Text1.Text
    AdodcMain.Recordset.Fields("CUST_NAME") = Text2.Text
    AdodcMain.Recordset.Fields("PHNO") = Text9.Text
    AdodcMain.Recordset.Fields("SALE_DATE") = Date
    AdodcMain.Recordset.Fields("NETAMT") = Text10.Text
    AdodcMain.Recordset.Update
    
    ' Update stock
    SQL = "UPDATE stock SET QTY = QTY - " & Text5.Text & _
          " WHERE PCODE = " & Text3.Text
    C.Execute SQL
    
    MsgBox "RECORD SAVED"
    ClearFields
End Sub

Private Sub Command3_Click()
    A
End Sub

Private Sub CalculateTotalAmount()
    SQL = "SELECT SUM(AMOUNT) FROM sale_details WHERE INV_NO=" & Text1.Text
    Set R = C.Execute(SQL)
    Text10.Text = IIf(IsNull(R(0)), 0, R(0))
End Sub

Private Sub ClearFields()
    Text2.Text = ""
    Text9.Text = ""
    Combo1.Text = ""
    Text4.Text = ""
    Text5.Text = ""
    Text6.Text = ""
    Text7.Text = ""
    Text8.Text = ""
End Sub

' frmPurchase.frm
Private Sub Form_Load()
    CONN
    SQL = "SELECT MAX(PUR_INV_NO) FROM PRODUCT_MASTER"
    Set R = C.Execute(SQL)
    Text1.Text = R.Fields(0) + 1
    Text1.Locked = True
    
    ' Load suppliers
    SQL = "SELECT S_NAME FROM SUPPLIER"
    Set R = C.Execute(SQL)
    Do While Not R.EOF
        Combo1.AddItem R!S_NAME
        R.MoveNext
    Loop
End Sub

Private Sub Command1_Click()
    AdodcPurchase.Recordset.AddNew
    Text1.SetFocus
End Sub

Private Sub Command2_Click()
    AdodcPurchase.Recordset.Update
    
    ' Update stock
    SQL = "UPDATE stock SET QTY = QTY + " & Text5.Text & _
          " WHERE PCODE = " & Text3.Text
    If C.Execute(SQL).RecordsAffected = 0 Then
        ' If product not in stock, insert new record
        SQL = "INSERT INTO stock (PCODE, PNAME, QTY) VALUES (" & _
              Text3.Text & ", '" & Combo2.Text & "', " & Text5.Text & ")"
        C.Execute SQL
    End If
    
    MsgBox "RECORD SAVED"
End Sub

Private Sub Command3_Click()
    A
End Sub

' frmReports.frm
Private Sub Form_Load()
    CONN
End Sub

Private Sub Command1_Click()
    ' Daily Sales Report
    SQL = "SELECT si.INV_NO, si.SALE_DATE, si.CUST_NAME, " & _
          "SUM(sd.AMOUNT) as TotalAmount " & _
          "FROM sale_INVOICE si " & _
          "INNER JOIN sale_details sd ON si.INV_NO = sd.INV_NO " & _
          "WHERE si.SALE_DATE = '" & Format(Date, "dd-MMM-yyyy") & "' " & _
          "GROUP BY si.INV_NO, si.SALE_DATE, si.CUST_NAME"
    Set DataReport1.DataSource = C.Execute(SQL)
    DataReport1.Show
End Sub

Private Sub Command2_Click()
    ' Stock Report
    SQL = "SELECT p.PCODE, p.PNAME, p.P_BRAND, s.QTY, p.MRP " & _
          "FROM product p INNER JOIN stock s ON p.PCODE = s.PCODE"
    Set DataReport2.DataSource = C.Execute(SQL)
    DataReport2.Show
End Sub

Private Sub Command3_Click()
    A
End Sub

' Forms needed for the project:
' 1. frmLogin.frm (First form)
' - Text1: Username
' - Text2: Password
' - Command1: Login
' - Command2: Exit

' 2. MDIForm1.frm (Container)
' - Menu items for all modules
' - Toolbar for quick access

' 3. frmProduct.frm
' - Text1: Product Code (Auto)
' - Text2: Product Name
' - Text3: Brand
' - Combo1: Product Type
' - Text4: Size
' - Text5: Color
' - Text6: Wattage
' - Text7: MRP
' - AdodcProduct: For grid
' - DataGrid1: Display products

' 4. frmSales.frm
' - Text1: Invoice No (Auto)
' - Text2: Customer Name
' - Text9: Phone
' - Combo1: Product Selection
' - Text3: Product Code
' - Text4: Price
' - Text5: Quantity
' - Text6: Amount
' - Text7: GST
' - Text8: Total
' - Text10: Grand Total
' - AdodcMain: For invoice
' - AdodcDetails: For items
' - DataGrid1: Items display

' 5. frmPurchase.frm
' Similar to sales but for purchases

' 6. frmReports.frm
' - Command buttons for different reports
' - DataReport controls for each report
